# Software Bill of Materials (SBOM) Generation

This document describes the SBOM generation process for the photon-mlir-bridge project.

## Overview

A Software Bill of Materials (SBOM) is a comprehensive inventory of all components, libraries, and dependencies used in our software. This is critical for:

- Supply chain security
- Vulnerability management  
- Compliance requirements
- Risk assessment

## SBOM Formats

We generate SBOMs in multiple standard formats:

### SPDX (Software Package Data Exchange)
- **Format**: JSON and RDF
- **Use Case**: Legal compliance and license management
- **Generated By**: `spdx-tools` and `syft`

### CycloneDX
- **Format**: JSON and XML
- **Use Case**: Security vulnerability management
- **Generated By**: `cyclonedx-bom` and `syft`

## Generation Process

### Python Dependencies

```bash
# Install SBOM generation tools
pip install cyclonedx-bom spdx-tools

# Generate CycloneDX SBOM for Python components
cyclonedx-py -o photon-mlir-python-sbom.json

# Generate SPDX SBOM for Python components  
spdx-tools generate-package photon-mlir-python --output-file photon-mlir-python.spdx.json
```

### C++ Dependencies

```bash
# Install syft for multi-language SBOM generation
curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin

# Generate comprehensive SBOM including C++ dependencies
syft packages dir:. -o spdx-json=photon-mlir-complete.spdx.json
syft packages dir:. -o cyclonedx-json=photon-mlir-complete.cyclonedx.json
```

### MLIR/LLVM Dependencies

```bash
# Custom script to capture MLIR/LLVM component versions
python scripts/generate_mlir_sbom.py --output mlir-components.sbom.json
```

## Automated SBOM Generation

### GitHub Actions Integration

Add to `.github/workflows/security.yml`:

```yaml
- name: Generate SBOM
  uses: anchore/sbom-action@v0
  with:
    path: .
    format: spdx-json
    upload-artifact: true
    upload-release-assets: true
```

### Build Integration

Add to `CMakeLists.txt`:

```cmake
# SBOM generation target
add_custom_target(generate-sbom
    COMMAND python ${CMAKE_SOURCE_DIR}/scripts/generate_complete_sbom.py
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "Generating Software Bill of Materials"
)
```

## SBOM Validation

### Integrity Verification

```bash
# Verify SBOM integrity with checksums
sha256sum photon-mlir-*.sbom.json > sbom-checksums.txt

# Sign SBOM with GPG
gpg --armor --detach-sign photon-mlir-complete.spdx.json
```

### Vulnerability Scanning

```bash
# Scan SBOM for known vulnerabilities using Grype
grype sbom:photon-mlir-complete.spdx.json

# Use OSV scanner for additional vulnerability detection
osv-scanner --sbom photon-mlir-complete.spdx.json
```

## SBOM Content Structure

### Required Components

1. **Package Information**
   - Name: photon-mlir-bridge
   - Version: From pyproject.toml/CMakeLists.txt
   - Supplier: Terragon Labs
   - Download Location: GitHub repository URL

2. **Python Dependencies**
   - Direct dependencies from pyproject.toml
   - Transitive dependencies with version pinning
   - License information for each package

3. **C++ Dependencies**
   - LLVM/MLIR version and commit hash
   - System libraries and their versions
   - Third-party C++ libraries

4. **Build Tools**
   - CMake version
   - Compiler version (GCC/Clang)
   - Python version used for builds

5. **Container Dependencies** (if applicable)
   - Base image information
   - Installed packages in container

### Example SBOM Entry

```json
{
  "name": "torch",
  "SPDXID": "SPDXRef-Package-torch-2.1.0",
  "downloadLocation": "https://pypi.org/project/torch/2.1.0/",
  "filesAnalyzed": false,
  "licenseConcluded": "BSD-3-Clause",
  "licenseDeclared": "BSD-3-Clause",
  "copyrightText": "Copyright (c) Meta Platforms",
  "supplier": "Organization: Meta Platforms, Inc.",
  "versionInfo": "2.1.0",
  "externalRefs": [
    {
      "referenceCategory": "PACKAGE-MANAGER",
      "referenceType": "purl",
      "referenceLocator": "pkg:pypi/torch@2.1.0"
    }
  ]
}
```

## SBOM Distribution

### Release Artifacts

SBOMs are automatically generated and included in every release:

- `photon-mlir-bridge-v1.0.0-sbom.spdx.json`
- `photon-mlir-bridge-v1.0.0-sbom.cyclonedx.json`
- `photon-mlir-bridge-v1.0.0-sbom-checksums.txt`
- `photon-mlir-bridge-v1.0.0-sbom.spdx.json.sig` (GPG signature)

### Container Registry

For containerized deployments, SBOMs are attached as artifacts:

```bash
# Attach SBOM to container image
oras attach ghcr.io/terragon/photon-mlir:latest \
  --artifact-type application/spdx+json \
  photon-mlir-complete.spdx.json:application/spdx+json
```

## Compliance and Reporting

### NTIA Minimum Elements

Our SBOMs include all NTIA minimum elements:

- ✅ Author name
- ✅ Component name  
- ✅ Version of component
- ✅ Other unique identifiers
- ✅ Dependency relationships
- ✅ Timestamp

### Executive Order 14028

Compliance with US Executive Order 14028 requirements:

- ✅ Machine-readable SBOM format
- ✅ Comprehensive dependency tracking
- ✅ Vulnerability correlation capability
- ✅ Integrity verification

## Maintenance

### Update Schedule

- **Daily**: Dependency vulnerability scanning
- **Weekly**: SBOM regeneration for development builds
- **Release**: Complete SBOM generation and verification
- **Quarterly**: SBOM process and tooling review

### Quality Checks

Automated validation ensures SBOM quality:

```bash
# Validate SPDX format
spdx-tools validate photon-mlir-complete.spdx.json

# Check for missing components
python scripts/validate_sbom_completeness.py

# Verify all dependencies are captured
python scripts/compare_deps_to_sbom.py
```

## Tools and References

### SBOM Generation Tools
- [Syft](https://github.com/anchore/syft) - Multi-language SBOM generator
- [CycloneDX Python](https://github.com/CycloneDX/cyclonedx-python) - Python-specific SBOM
- [SPDX Tools](https://github.com/spdx/tools-python) - SPDX format tools

### Vulnerability Scanning
- [Grype](https://github.com/anchore/grype) - Vulnerability scanner for containers and filesystems
- [OSV Scanner](https://github.com/google/osv-scanner) - Open Source Vulnerability scanner

### Standards and Specifications
- [SPDX Specification](https://spdx.github.io/spdx-spec/)
- [CycloneDX Specification](https://cyclonedx.org/specification/overview/)
- [NTIA SBOM Guidelines](https://www.ntia.doc.gov/report/2021/minimum-elements-software-bill-materials-sbom)

This comprehensive SBOM process ensures full transparency and security compliance for the photon-mlir-bridge project.